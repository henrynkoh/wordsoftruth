<% content_for :title, "ğŸ“ í…ìŠ¤íŠ¸ ë…¸íŠ¸" %>

<div class="container mx-auto px-4 py-6">
  <!-- Header with mobile-first design -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">ğŸ“ ì˜ì  í…ìŠ¤íŠ¸ ë…¸íŠ¸</h1>
      <p class="text-gray-600">ì†ìœ¼ë¡œ ì“´ ë©”ëª¨ì™€ ì˜ê°ì„ YouTube Shortsë¡œ ë³€í™˜</p>
    </div>
    
    <div class="mt-4 sm:mt-0 flex flex-col sm:flex-row gap-2">
      <%= link_to new_text_note_path, 
          class: "btn btn-primary text-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" do %>
        âœï¸ ìƒˆ ë…¸íŠ¸ ì‘ì„±
      <% end %>
      
      <%= link_to templates_text_notes_path, 
          class: "btn btn-secondary text-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",
          remote: true do %>
        ğŸ“‹ í…œí”Œë¦¿ ë³´ê¸°
      <% end %>
    </div>
  </div>

  <!-- Stats Cards (Mobile-friendly) -->
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-lg shadow p-4 text-center">
      <div class="text-2xl font-bold text-blue-600"><%= @text_notes.count %></div>
      <div class="text-sm text-gray-600">ì´ ë…¸íŠ¸</div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 text-center">
      <div class="text-2xl font-bold text-green-600">
        <%= @status_counts['completed'] || 0 %>
      </div>
      <div class="text-sm text-gray-600">ì™„ì„±ëœ ì˜ìƒ</div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 text-center">
      <div class="text-2xl font-bold text-yellow-600">
        <%= @status_counts['processing'] || 0 %>
      </div>
      <div class="text-sm text-gray-600">ìƒì„± ì¤‘</div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 text-center">
      <div class="text-2xl font-bold text-red-600">
        <%= @status_counts['failed'] || 0 %>
      </div>
      <div class="text-sm text-gray-600">ì‹¤íŒ¨</div>
    </div>
  </div>

  <!-- Filter Controls (Mobile-optimized) -->
  <div class="bg-white rounded-lg shadow mb-6 p-4">
    <div class="flex flex-col sm:flex-row gap-4">
      <!-- Theme Filter -->
      <div class="flex-1">
        <label class="block text-sm font-medium text-gray-700 mb-2">í…Œë§ˆë³„ í•„í„°</label>
        <select id="theme-filter" class="w-full border border-gray-300 rounded-lg px-3 py-2">
          <option value="">ëª¨ë“  í…Œë§ˆ</option>
          <option value="golden_light" <%= 'selected' if params[:theme] == 'golden_light' %>>ğŸŒŸ ì°¬ì–‘ê³¼ ê²½ë°°</option>
          <option value="peaceful_blue" <%= 'selected' if params[:theme] == 'peaceful_blue' %>>ğŸ•¯ï¸ ê¸°ë„ì™€ ë¬µìƒ</option>
          <option value="sunset_worship" <%= 'selected' if params[:theme] == 'sunset_worship' %>>ğŸŒ… ì €ë… ê²½ê±´</option>
          <option value="cross_pattern" <%= 'selected' if params[:theme] == 'cross_pattern' %>>âœï¸ ì„±ê²½ê³¼ ë¯¿ìŒ</option>
          <option value="mountain_majesty" <%= 'selected' if params[:theme] == 'mountain_majesty' %>>â›°ï¸ í˜ê³¼ ì¸ë‚´</option>
          <option value="flowing_river" <%= 'selected' if params[:theme] == 'flowing_river' %>>ğŸŒŠ ìƒˆë¡œìš´ ìƒëª…</option>
        </select>
      </div>
      
      <!-- Status Filter -->
      <div class="flex-1">
        <label class="block text-sm font-medium text-gray-700 mb-2">ìƒíƒœë³„ í•„í„°</label>
        <select id="status-filter" class="w-full border border-gray-300 rounded-lg px-3 py-2">
          <option value="">ëª¨ë“  ìƒíƒœ</option>
          <option value="draft" <%= 'selected' if params[:status] == 'draft' %>>ğŸ“ ì´ˆì•ˆ</option>
          <option value="processing" <%= 'selected' if params[:status] == 'processing' %>>âš™ï¸ ì²˜ë¦¬ ì¤‘</option>
          <option value="completed" <%= 'selected' if params[:status] == 'completed' %>>âœ… ì™„ë£Œ</option>
          <option value="failed" <%= 'selected' if params[:status] == 'failed' %>>âŒ ì‹¤íŒ¨</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Text Notes Grid (Mobile-responsive) -->
  <% if @text_notes.any? %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @text_notes.each do |note| %>
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
          <!-- Header -->
          <div class="p-4 border-b border-gray-100">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="font-semibold text-gray-900 truncate">
                  <%= note.title.presence || "ì œëª© ì—†ìŒ" %>
                </h3>
                <div class="flex items-center gap-2 mt-1">
                  <span class="theme-badge <%= note.theme %> text-xs px-2 py-1 rounded-full">
                    <%= get_theme_display(note.theme) %>
                  </span>
                  <span class="status-badge <%= note.status %> text-xs px-2 py-1 rounded-full">
                    <%= get_status_display(note.status) %>
                  </span>
                </div>
              </div>
              
              <div class="dropdown relative">
                <button class="text-gray-400 hover:text-gray-600" onclick="toggleDropdown(this)">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01" />
                  </svg>
                </button>
                
                <div class="dropdown-menu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden z-10">
                  <%= link_to note, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" do %>
                    ğŸ‘ï¸ ë³´ê¸°
                  <% end %>
                  <%= link_to edit_text_note_path(note), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" do %>
                    âœï¸ í¸ì§‘
                  <% end %>
                  <% if note.draft? || note.failed? %>
                    <%= link_to generate_video_text_note_path(note), method: :post, 
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" do %>
                      ğŸ¬ ì˜ìƒ ìƒì„±
                    <% end %>
                  <% end %>
                  <% if note.completed? && note.video_file_path.present? %>
                    <%= link_to upload_to_youtube_text_note_path(note), method: :post, 
                        class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" do %>
                      ğŸ“º YouTube ì—…ë¡œë“œ
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Content Preview -->
          <div class="p-4">
            <p class="text-gray-700 text-sm line-clamp-3">
              <%= truncate(note.content, length: 100) %>
            </p>
            
            <div class="mt-3 flex justify-between items-center text-xs text-gray-500">
              <span><%= note.korean_character_count %>ì</span>
              <span><%= note.estimated_duration&.round(1) %>ì´ˆ ì˜ˆìƒ</span>
              <span><%= time_ago_in_words(note.created_at) %> ì „</span>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="px-4 pb-4">
            <%= link_to note, 
                class: "w-full btn btn-primary bg-blue-600 text-white text-center py-2 rounded-lg hover:bg-blue-700 transition-colors block" do %>
              ìì„¸íˆ ë³´ê¸°
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <!-- Pagination -->
    <div class="mt-8 flex justify-center text-gray-500 text-sm">
      ìµœëŒ€ 20ê°œì˜ ë…¸íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="text-center py-12">
      <div class="text-6xl mb-4">ğŸ“</div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">ì•„ì§ í…ìŠ¤íŠ¸ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
      <p class="text-gray-600 mb-6">ì²« ë²ˆì§¸ ì˜ì  ë…¸íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ YouTube Shortsë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
      
      <%= link_to new_text_note_path, 
          class: "btn btn-primary bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors inline-block" do %>
        âœï¸ ì²« ë…¸íŠ¸ ì‘ì„±í•˜ê¸°
      <% end %>
    </div>
  <% end %>
</div>

<!-- Mobile-friendly JavaScript -->
<script>
// Theme display helper
function getThemeDisplay(theme) {
  const themes = {
    'golden_light': 'ğŸŒŸ ì°¬ì–‘ê³¼ ê²½ë°°',
    'peaceful_blue': 'ğŸ•¯ï¸ ê¸°ë„ì™€ ë¬µìƒ',
    'sunset_worship': 'ğŸŒ… ì €ë… ê²½ê±´',
    'cross_pattern': 'âœï¸ ì„±ê²½ê³¼ ë¯¿ìŒ',
    'mountain_majesty': 'â›°ï¸ í˜ê³¼ ì¸ë‚´',
    'flowing_river': 'ğŸŒŠ ìƒˆë¡œìš´ ìƒëª…',
    'wheat_field': 'ğŸŒ¾ í’ì„±í•œ ì¶•ë³µ',
    'shepherd_field': 'ğŸ‘ ì¸ë„í•˜ì‹¬',
    'temple_light': 'ğŸ›ï¸ ê±°ë£©í•œ ì„±ì „',
    'city_lights': 'ğŸŒƒ ì„¸ìƒì˜ ë¹›'
  };
  return themes[theme] || theme;
}

// Status display helper  
function getStatusDisplay(status) {
  const statuses = {
    'draft': 'ğŸ“ ì´ˆì•ˆ',
    'processing': 'âš™ï¸ ì²˜ë¦¬ ì¤‘',
    'completed': 'âœ… ì™„ë£Œ',
    'failed': 'âŒ ì‹¤íŒ¨'
  };
  return statuses[status] || status;
}

// Dropdown toggle
function toggleDropdown(button) {
  const dropdown = button.nextElementSibling;
  dropdown.classList.toggle('hidden');
  
  // Close other dropdowns
  document.querySelectorAll('.dropdown-menu').forEach(menu => {
    if (menu !== dropdown) {
      menu.classList.add('hidden');
    }
  });
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
  if (!event.target.closest('.dropdown')) {
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
      menu.classList.add('hidden');
    });
  }
});

// Filter functionality
document.getElementById('theme-filter').addEventListener('change', function() {
  updateFilters();
});

document.getElementById('status-filter').addEventListener('change', function() {
  updateFilters();
});

function updateFilters() {
  const theme = document.getElementById('theme-filter').value;
  const status = document.getElementById('status-filter').value;
  
  const params = new URLSearchParams();
  if (theme) params.append('theme', theme);
  if (status) params.append('status', status);
  
  window.location.href = '/text_notes?' + params.toString();
}
</script>

<style>
/* Mobile-optimized styles */
.theme-badge {
  font-size: 0.75rem;
  background-color: #f3f4f6;
  color: #374151;
}

.theme-badge.golden_light { background-color: #fef3c7; color: #d97706; }
.theme-badge.peaceful_blue { background-color: #dbeafe; color: #2563eb; }
.theme-badge.sunset_worship { background-color: #fed7aa; color: #ea580c; }
.theme-badge.cross_pattern { background-color: #f3e8ff; color: #7c3aed; }

.status-badge {
  font-size: 0.75rem;
}

.status-badge.draft { background-color: #f3f4f6; color: #6b7280; }
.status-badge.processing { background-color: #fef3c7; color: #d97706; }
.status-badge.completed { background-color: #d1fae5; color: #10b981; }
.status-badge.failed { background-color: #fee2e2; color: #ef4444; }

.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

@media (max-width: 640px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}
</style>